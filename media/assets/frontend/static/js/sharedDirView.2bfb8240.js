"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[319],{35841:function(e,t,a){var i=a(15671),s=a(43144),n=a(60136),r=a(29388),o=a(72791),l=a(62298),c=a(4292),d=a(95234),h=a(53585),p=a(80184),u=function(e){(0,n.Z)(a,e);var t=(0,r.Z)(a);function a(){return(0,i.Z)(this,a),t.apply(this,arguments)}return(0,s.Z)(a,[{key:"render",value:function(){var e=this.props,t=e.type,a=e.asyncOperationProgress,i=e.asyncOperatedFilesLength,s="move"===t?(0,h.ih)("Move {num} items"):(0,h.ih)("Copy {num} items");s=s.replace("{num}",i);var n={width:a+"%",lineHeight:"40px",textAlign:"left"};return(0,p.jsxs)(l.Z,{isOpen:!0,children:[(0,p.jsx)(c.Z,{toggle:this.props.toggleDialog,children:s}),(0,p.jsx)(d.Z,{style:{minHeight:"80px"},children:(0,p.jsx)("div",{className:"progress",style:{height:"40px"},children:(0,p.jsx)("div",{className:"progress-bar pl-2",role:"progressbar",style:n,"aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100",children:a+"%"})})})]})}}]),a}(o.Component);t.Z=u},89897:function(e,t,a){var i=a(15671),s=a(43144),n=a(60136),r=a(29388),o=a(72791),l=a(53585),c=a(476),d=(a(71639),a(80184)),h=function(e){(0,n.Z)(a,e);var t=(0,r.Z)(a);function a(e){return(0,i.Z)(this,a),t.call(this,e)}return(0,s.Z)(a,[{key:"render",value:function(){var e=this.props.imageItems,t=this.props.imageIndex,a=e.length,i=e[t].name,s="".concat(i," (").concat(t+1,"/").concat(a,")");return(0,d.jsx)(c.Z,{imageTitle:s,mainSrc:e[t].src,nextSrc:e[(t+1)%a].src,prevSrc:e[(t+a-1)%a].src,onCloseRequest:this.props.closeImagePopup,onMovePrevRequest:this.props.moveToPrevImage,onMoveNextRequest:this.props.moveToNextImage,imagePadding:70,imageLoadErrorMessage:(0,l.ih)("The image could not be loaded."),prevLabel:(0,l.ih)("Previous (Left arrow key)"),nextLabel:(0,l.ih)("Next (Right arrow key)"),closeLabel:(0,l.ih)("Close (Esc)"),zoomInLabel:(0,l.ih)("Zoom in"),zoomOutLabel:(0,l.ih)("Zoom out")})}}]),a}(o.Component);t.Z=h},48036:function(e,t,a){var i=a(15671),s=a(43144),n=a(60136),r=a(29388),o=a(72791),l=a(62298),c=a(4292),d=a(95234),h=a(95060),p=a(81815),u=a(72426),m=a.n(u),g=a(53585),f=a(22228),v=a(95996),x=a(51832),j=a(80184),b=function(e){(0,n.Z)(a,e);var t=(0,r.Z)(a);function a(e){var s;return(0,i.Z)(this,a),(s=t.call(this,e)).onFileTagChanged=function(e){var t=e.parent_path,a={name:e.filename},i="/"===t?t+e.filename:t+"/"+e.filename;s.props.onFileTagChanged(a,i)},s.onDeleteTaggedFile=function(e){var t=s.props.repoID,a=e.file_tag_id;f.I.deleteFileTag(t,a).then((function(t){s.getTaggedFiles(),s.props.updateUsedRepoTags(),s.props.onFileTagChanged&&!e.file_deleted&&s.onFileTagChanged(e)})).catch((function(e){var t=v.c.getErrorMsg(e);x.Z.danger(t)}))},s.getTaggedFiles=function(){var e=s.props,t=e.repoID,a=e.currentTag,i=e.shareLinkToken;(i?f.I.getShareLinkTaggedFiles(i,a.id):f.I.listTaggedFiles(t,a.id)).then((function(e){var t=[];void 0!==e.data.tagged_files&&e.data.tagged_files.forEach((function(e){var a=e;t.push(a)})),s.setState({taggedFileList:t})})).catch((function(e){var t=v.c.getErrorMsg(e);x.Z.danger(t)}))},s.state={taggedFileList:[]},s}return(0,s.Z)(a,[{key:"componentDidMount",value:function(){this.getTaggedFiles()}},{key:"render",value:function(){var e=this,t=this.state.taggedFileList;return(0,j.jsxs)(l.Z,{isOpen:!0,style:{maxWidth:"678px"},children:[(0,j.jsx)(c.Z,{toggle:this.props.onClose,children:(0,g.ih)("Tagged Files")}),(0,j.jsx)(d.Z,{className:"dialog-list-container",children:(0,j.jsxs)("table",{children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{width:"50%",className:"ellipsis",children:(0,g.ih)("Name")}),(0,j.jsx)("th",{width:"20%",children:(0,g.ih)("Size")}),(0,j.jsx)("th",{width:"22%",children:(0,g.ih)("Last Update")}),(0,j.jsx)("th",{width:"8%"})]})}),(0,j.jsx)("tbody",{children:t.map((function(t,a){return(0,j.jsx)(S,{repoID:e.props.repoID,taggedFile:t,onDeleteTaggedFile:e.onDeleteTaggedFile,shareLinkToken:e.props.shareLinkToken,enableFileDownload:e.props.enableFileDownload},a)}))})]})}),(0,j.jsx)(h.Z,{children:(0,j.jsx)(p.Z,{color:"secondary",onClick:this.props.toggleCancel,children:(0,g.ih)("Close")})})]})}}]),a}(o.Component);t.Z=b;var S=function(e){(0,n.Z)(a,e);var t=(0,r.Z)(a);function a(e){var s;return(0,i.Z)(this,a),(s=t.call(this,e)).onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.setState({active:!1})},s.deleteFile=function(e){e.preventDefault(),s.props.onDeleteTaggedFile(s.props.taggedFile)},s.state={active:!1},s}return(0,s.Z)(a,[{key:"render",value:function(){var e=this.props,t=e.taggedFile,a=e.shareLinkToken,i=e.enableFileDownload,s=t.parent_path?v.c.joinPath(t.parent_path,t.filename):"",n=a?g.ze+"d/"+a+"/files/?p="+v.c.encodePath(s):g.ze+"lib/"+this.props.repoID+"/file"+v.c.encodePath(s);return(0,j.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onMouseEnter,children:[t.file_deleted?(0,j.jsx)(o.Fragment,{children:(0,j.jsxs)("td",{colSpan:"3",className:"name",children:[t.filename," ",(0,j.jsx)("span",{style:{color:"red"},children:(0,g.ih)("deleted")})]})}):(0,j.jsxs)(o.Fragment,{children:[(0,j.jsx)("td",{children:(0,j.jsx)("a",{href:n,target:"_blank",className:"d-inline-block w-100 ellipsis",title:t.filename,rel:"noreferrer",children:t.filename})}),(0,j.jsx)("td",{children:v.c.bytesToSize(t.size)}),(0,j.jsx)("td",{children:m().unix(t.mtime).fromNow()})]}),(0,j.jsxs)("td",{children:[!a&&(0,j.jsx)("a",{href:"#",role:"button","aria-label":(0,g.ih)("Delete"),title:(0,g.ih)("Delete"),className:"action-icon sf2-icon-x3".concat(this.state.active?"":" invisible"),onClick:this.deleteFile}),a&&i&&(0,j.jsx)("a",{className:"action-icon sf2-icon-download".concat(this.state.active?"":" invisible"),href:"".concat(n,"&dl=1"),title:(0,g.ih)("Download"),"aria-label":(0,g.ih)("Download")})]})]})}}]),a}(o.Component)},22724:function(e,t,a){var i,s=a(15671),n=a(43144),r=a(60136),o=a(29388),l=a(72791),c=a(62298),d=a(4292),h=a(95234),p=a(53585),u=a(22228),m=a(95996),g=a(63446),f=a(80184),v=function(e){(0,r.Z)(a,e);var t=(0,o.Z)(a);function a(e){var n;return(0,s.Z)(this,a),(n=t.call(this,e)).queryZipProgress=function(){var e=n.state.zipToken;u.I.queryZipProgress(e).then((function(t){var a=t.data;1==a.failed?(clearInterval(i),n.setState({isLoading:!1,errorMsg:a.failed_reason})):(n.setState({zipProgress:0==a.total?"100%":(a.zipped/a.total*100).toFixed(2)+"%"}),a.total==a.zipped&&(clearInterval(i),n.props.toggleDialog(),location.href="".concat(p.gc,"zip/").concat(e)))})).catch((function(e){clearInterval(i);var t=m.c.getErrorMsg(e);n.setState({isLoading:!1,errorMsg:t})}))},n.cancelZipTask=function(){var e=n.state.zipToken;u.I.cancelZipTask(e).then((function(e){})).catch((function(e){}))},n.toggleDialog=function(){var e=n.state.zipProgress;e&&"100%"!=e&&(clearInterval(i),n.cancelZipTask()),n.props.toggleDialog()},n.state={isLoading:!0,errorMsg:"",zipProgress:null},n}return(0,n.Z)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.token,s=t.path,n=t.repoID,r=t.target;(a?r.length?u.I.getShareLinkDirentsZipTask(a,s,r):u.I.getShareLinkZipTask(a,s):u.I.zipDownload(n,s,r)).then((function(t){var a=t.data.zip_token;e.setState({isLoading:!1,errorMsg:"",zipToken:a}),e.queryZipProgress(),i=setInterval(e.queryZipProgress,1e3)})).catch((function(t){var a=m.c.getErrorMsg(t);e.setState({isLoading:!1,errorMsg:a})}))}},{key:"render",value:function(){return(0,f.jsxs)(c.Z,{isOpen:!0,toggle:this.toggleDialog,children:[(0,f.jsx)(d.Z,{toggle:this.toggleDialog,children:(0,p.ih)("Download")}),(0,f.jsx)(h.Z,{children:(0,f.jsx)(x,{data:this.state})})]})}}]),a}(l.Component),x=function(e){(0,r.Z)(a,e);var t=(0,o.Z)(a);function a(){return(0,s.Z)(this,a),t.apply(this,arguments)}return(0,n.Z)(a,[{key:"render",value:function(){var e=this.props.data,t=e.isLoading,a=e.errorMsg,i=e.zipProgress;return t?(0,f.jsx)(g.Z,{}):a?(0,f.jsx)("p",{className:"error mt-4 text-center",children:a}):(0,f.jsx)("p",{className:"mt-4 text-center",children:"".concat((0,p.ih)("Packaging...")," ").concat(i)})}}]),a}(l.Component);t.Z=v},83339:function(e,t,a){a.d(t,{Z:function(){return y}});var i=a(15671),s=a(43144),n=a(60136),r=a(29388),o=a(72791),l=a(53885),c=a(48036),d=a(62298),h=a(4292),p=a(95234),u=a(95060),m=a(81815),g=a(53585),f=a(22228),v=a(72426),x=a.n(v),j=a(39571),b=a(51832),S=a(95996),k=(0,s.Z)((function e(t){(0,i.Z)(this,e),this.created=t.created_at,this.createdStr=x()(new Date(t.created_at).getTime()).format("YYYY-MM-DD HH:mm"),this.id=t.id,this.ownerNickname=t.owner_nickname,this.originRepoID=t.origin_repo_id,this.draftFilePath=t.draft_file_path})),F=a(80184),I=function(e){(0,n.Z)(a,e);var t=(0,r.Z)(a);function a(e){var s;return(0,i.Z)(this,a),(s=t.call(this,e)).onDeleteDraftItem=function(e){j.Z.deleteDraft(e.id).then((function(){var t=s.state.drafts.filter((function(t){return t.id!==e.id}));s.setState({drafts:t});var a=(0,g.ih)("Successfully deleted draft %(draft)s.");a=a.replace("%(draft)s",e.draftFilePath),b.Z.success(a)})).catch((function(){var t=(0,g.ih)("Failed to delete draft %(draft)s.");t=t.replace("%(draft)s",e.draftFilePath),b.Z.danger(t)}))},s.toggle=function(){s.props.toggle()},s.state={drafts:[]},s}return(0,s.Z)(a,[{key:"componentDidMount",value:function(){var e=this;f.I.listRepoDrafts(this.props.repoID).then((function(t){var a=t.data.drafts.map((function(e){return new k(e)}));e.setState({drafts:a})}))}},{key:"render",value:function(){var e=this;return(0,F.jsxs)(d.Z,{isOpen:!0,children:[(0,F.jsx)(h.Z,{toggle:this.toggle,children:(0,g.ih)("Drafts")}),(0,F.jsx)(p.Z,{className:"dialog-list-container",children:(0,F.jsxs)("table",{children:[(0,F.jsx)("thead",{children:(0,F.jsxs)("tr",{children:[(0,F.jsx)("th",{width:"50%",className:"ellipsis",children:(0,g.ih)("Name")}),(0,F.jsx)("th",{width:"20%",children:(0,g.ih)("Owner")}),(0,F.jsx)("th",{width:"20%",children:(0,g.ih)("Last Update")}),(0,F.jsx)("th",{width:"10%"})]})}),(0,F.jsx)("tbody",{children:this.state.drafts.map((function(t,a){return(0,F.jsx)(w,{draftItem:t,onDeleteDraftItem:e.onDeleteDraftItem},a)}))})]})}),(0,F.jsx)(u.Z,{children:(0,F.jsx)(m.Z,{color:"secondary",onClick:this.toggle,children:(0,g.ih)("Close")})})]})}}]),a}(o.Component),w=function(e){(0,n.Z)(a,e);var t=(0,r.Z)(a);function a(e){var s;return(0,i.Z)(this,a),(s=t.call(this,e)).onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.setState({active:!1})},s.state={active:!1},s}return(0,s.Z)(a,[{key:"render",value:function(){var e=this.props.draftItem,t=g.ze+"drafts/"+e.id+"/",a=this.state.active?"action-icon sf2-icon-x3":"action-icon vh sf2-icon-x3";return(0,F.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,F.jsx)("td",{className:"name",children:(0,F.jsx)("a",{href:t,target:"_blank",children:S.c.getFileName(e.draftFilePath)})}),(0,F.jsx)("td",{children:e.ownerNickname}),(0,F.jsx)("td",{children:x()(e.createdStr).fromNow()}),(0,F.jsx)("td",{children:(0,F.jsx)("i",{className:a,onClick:this.props.onDeleteDraftItem.bind(this,e)})})]})}}]),a}(o.Component),C=a(50850),Z=a(63446),D=function(e){(0,n.Z)(a,e);var t=(0,r.Z)(a);function a(e){var s;return(0,i.Z)(this,a),(s=t.call(this,e)).state={readmeContent:null,isLoading:!0},s}return(0,s.Z)(a,[{key:"componentDidMount",value:function(){var e=this;f.I.getFileDownloadLink(this.props.repoID,this.props.filePath).then((function(t){f.I.getFileContent(t.data).then((function(t){e.setState({readmeContent:t.data,isLoading:!1})}))})).catch((function(e){var t=S.c.getErrorMsg(e);b.Z.danger(t)}))}},{key:"render",value:function(){return(0,F.jsxs)(d.Z,{isOpen:!0,toggle:this.props.toggleCancel,className:"readme-dialog",size:"lg",children:[(0,F.jsxs)(h.Z,{children:[this.props.fileName,(0,F.jsx)("a",{className:"readme-dialog-edit",href:this.props.href,target:"_blank",children:(0,F.jsx)("i",{className:"fa fa-pencil-alt"})})]}),(0,F.jsx)(p.Z,{children:this.state.isLoading?(0,F.jsx)(Z.Z,{}):(0,F.jsx)(C.av,{markdownContent:this.state.readmeContent,showTOC:!1,scriptSource:g.si+"js/mathjax/tex-svg.js"})}),(0,F.jsx)(u.Z,{children:(0,F.jsx)(m.Z,{color:"secondary",onClick:this.props.toggleCancel,children:(0,g.ih)("Close")})})]})}}]),a}(o.Component),y=function(e){(0,n.Z)(a,e);var t=(0,r.Z)(a);function a(e){var s;return(0,i.Z)(this,a),(s=t.call(this,e)).onListTaggedFiles=function(e){s.setState({currentTag:e,isListTaggedFileShow:!s.state.isListTaggedFileShow})},s.onCloseDialog=function(){s.setState({isListTaggedFileShow:!1})},s.toggleDrafts=function(){s.setState({showRepoDrafts:!s.state.showRepoDrafts})},s.toggleReadme=function(){s.setState({showReadmeDialog:!s.state.showReadmeDialog})},s.state={currentTag:null,isListTaggedFileShow:!1,showRepoDrafts:!1,showReadmeDialog:!1},s}return(0,s.Z)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.repoID,i=t.currentPath,s=t.usedRepoTags,n=t.readmeMarkdown,r=t.draftCounts,o=t.className;void 0===n&&(n=null),void 0===r&&(r=0);var d=null!==n?g.ze+"lib/"+a+"/file"+S.c.joinPath(i,n.name)+"?mode=edit":"",h=null!==n?i+n.name:"";return(0,F.jsxs)("div",{className:"repo-info-bar ".concat(o||""),children:[s.length>0&&(0,F.jsx)("ul",{className:"used-tag-list",children:s.map((function(t){return(0,F.jsxs)("li",{className:"used-tag-item",children:[(0,F.jsx)("span",{className:"used-tag",style:{backgroundColor:t.color}}),(0,F.jsx)("span",{className:"used-tag-name",title:t.name,children:t.name}),(0,F.jsx)("button",{type:"button",className:"used-tag-files border-0 bg-transparent",onClick:e.onListTaggedFiles.bind(e,t),children:t.fileCount>1?t.fileCount+" files":t.fileCount+" file"})]},t.id)}))}),(0,F.jsxs)("div",{className:s.length>0&&n?"file-info-list mt-1":"file-info-list",children:[null!==n&&parseInt(n.size)>1&&(0,F.jsxs)("span",{className:"file-info",onClick:this.toggleReadme,children:[(0,F.jsx)("span",{className:"info-icon sf2-icon-readme"}),(0,F.jsx)("span",{className:"used-tag-name",children:n.name})]}),null!==n&&parseInt(n.size)<2&&(0,F.jsxs)("span",{className:"file-info",children:[(0,F.jsx)("span",{className:"info-icon sf2-icon-readme"}),(0,F.jsx)("a",{className:"used-tag-name",href:d,target:"_blank",rel:"noreferrer",children:n.name})]}),r>0&&(0,F.jsxs)("span",{className:"file-info",children:[(0,F.jsx)("span",{className:"info-icon sf2-icon-drafts"}),(0,F.jsx)("span",{className:"used-tag-name",children:(0,g.ih)("draft")}),(0,F.jsx)("button",{type:"button",className:"used-tag-files border-0 bg-transparent",onClick:this.toggleDrafts,children:r>1?r+" files":r+" file"})]})]}),this.state.isListTaggedFileShow&&(0,F.jsx)(l.Z,{children:(0,F.jsx)(c.Z,{repoID:a,currentTag:this.state.currentTag,onClose:this.onCloseDialog,toggleCancel:this.onListTaggedFiles,updateUsedRepoTags:this.props.updateUsedRepoTags,onFileTagChanged:this.props.onFileTagChanged,shareLinkToken:this.props.shareLinkToken,enableFileDownload:this.props.enableFileDownload})}),this.state.showRepoDrafts&&(0,F.jsx)(l.Z,{children:(0,F.jsx)(I,{toggle:this.toggleDrafts,repoID:this.props.repoID})}),this.state.showReadmeDialog&&(0,F.jsx)(l.Z,{children:(0,F.jsx)(D,{toggleCancel:this.toggleReadme,repoID:a,filePath:h,href:d,fileName:n.name})})]})}}]),a}(o.Component)},9406:function(e,t,a){var i=a(74165),s=a(15861),n=a(15671),r=a(43144),o=a(97326),l=a(60136),c=a(29388),d=a(72791),h=a(10753),p=a.n(h),u=a(54164),m=a(81815),g=a(61599),f=a(20387),v=a(52919),x=a(98290),j=a(72426),b=a.n(j),S=a(55516),k=a(53585),F=a(95996),I=a(22228),w=a(63446),C=a(51832),Z=a(53885),D=a(22724),y=a(89897),N=a(93433),U=a(53008),P=a.n(U),L=a(80184),M="uploading",_="error",O="isSaving",z="uploaded",T=function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(e){var i;return(0,n.Z)(this,a),(i=t.call(this,e)).onUploadCancel=function(e){e.preventDefault(),i.props.onUploadCancel(i.props.resumableFile)},i.onUploadRetry=function(e){e.preventDefault(),i.props.onUploadRetry(i.props.resumableFile)},i.formatFileSize=function(e){return"number"!==typeof e?"":e>=1e9?(e/1e9).toFixed(1)+" G":e>=1e6?(e/1e6).toFixed(1)+" M":e>=1e3?(e/1e3).toFixed(1)+" K":e.toFixed(1)+" B"},i.state={uploadState:M},i}return(0,r.Z)(a,[{key:"componentWillReceiveProps",value:function(e){var t=e.resumableFile,a=M;t.error?a=_:(0!==t.remainingTime||t.isSaved||(a=O),t.isSaved&&(a=z)),this.setState({uploadState:a})}},{key:"render",value:function(){var e=this.props.resumableFile,t=Math.round(100*e.progress()),a=e.error,i=e.newFileName,s=this.formatFileSize(e.size);return(0,L.jsxs)("tr",{className:"file-upload-item",children:[(0,L.jsx)("td",{className:"upload-name",children:(0,L.jsx)("div",{className:"ellipsis",title:i,children:i})}),(0,L.jsx)("td",{className:"ellipsis",children:(0,L.jsx)("span",{className:"file-size",title:s,children:s})}),(0,L.jsxs)("td",{className:"upload-progress ellipsis",children:[(this.state.uploadState===M||this.state.uploadState===O)&&(0,L.jsxs)(d.Fragment,{children:[e.size>=1e8&&(0,L.jsxs)(d.Fragment,{children:[e.isUploading()&&(0,L.jsxs)("div",{className:"progress-container",children:[(0,L.jsx)("div",{className:"progress",children:(0,L.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})}),-1===e.remainingTime&&(0,L.jsx)("div",{className:"progress-text",children:(0,k.ih)("Preparing to upload...")}),e.remainingTime>0&&(0,L.jsxs)("div",{className:"progress-text",children:[(0,k.ih)("Remaining")," ",F.c.formatTime(e.remainingTime)]}),0===e.remainingTime&&(0,L.jsx)("div",{className:"progress-text",children:(0,k.ih)("Indexing...")})]}),!e.isUploading()&&(0,L.jsx)("div",{className:"progress-container d-flex align-items-center",children:(0,L.jsx)("div",{className:"progress",children:(0,L.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})})]}),e.size<1e8&&(0,L.jsx)("div",{className:"progress-container d-flex align-items-center",children:(0,L.jsx)("div",{className:"progress",children:(0,L.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})})]}),this.state.uploadState===_&&(0,L.jsx)("div",{className:"message err-message ml-0",dangerouslySetInnerHTML:{__html:a}})]}),(0,L.jsx)("td",{className:"upload-operation ellipsis",children:(0,L.jsxs)(d.Fragment,{children:[this.state.uploadState===M&&(0,L.jsx)("a",{href:"#",onClick:this.onUploadCancel,children:(0,k.ih)("Cancel")}),this.state.uploadState===_&&(0,L.jsx)("a",{href:"#",onClick:this.onUploadRetry,children:(0,k.ih)("Retry")}),this.state.uploadState===O&&(0,L.jsx)("span",{className:"saving",children:(0,k.ih)("Saving...")}),this.state.uploadState===z&&(0,L.jsx)("span",{className:"uploaded",children:(0,k.ih)("Uploaded")})]})})]})}}]),a}(d.Component),R=function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(){return(0,n.Z)(this,a),t.apply(this,arguments)}return(0,r.Z)(a,[{key:"render",value:function(){var e=this.props.file,t=(0,k.ih)("Please upload files less than {placeholder}M").replace("{placeholder}",k.Og);return(0,L.jsxs)("tr",{className:"file-upload-item",children:[(0,L.jsx)("td",{className:"upload-name",children:(0,L.jsx)("div",{className:"ellipsis",title:e.name,children:e.name})}),(0,L.jsx)("td",{colSpan:3,className:"error",children:t})]})}}]),a}(d.Component),E=R,A=function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(e){var i;return(0,n.Z)(this,a),(i=t.call(this,e)).onCancelAllUploading=function(){i.props.onCancelAllUploading()},i.onMinimizeUpload=function(e){e.nativeEvent.stopImmediatePropagation(),i.setState({isMinimized:!i.state.isMinimized})},i.onCloseUpload=function(e){e.nativeEvent.stopImmediatePropagation(),i.props.onCloseUploadDialog()},i.state={isMinimized:!1},i}return(0,r.Z)(a,[{key:"render",value:function(){var e=this,t=F.c.formatBitRate(this.props.uploadBitrate),a=(0,k.ih)("File Upload"),i=(0,k.ih)("File Uploading...")+" "+this.props.totalProgress+"% ("+t+")",s=(0,L.jsx)("span",{className:"sf2-icon-minus",onClick:this.onMinimizeUpload}),n=(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("span",{className:"sf2-icon-minus",onClick:this.onMinimizeUpload}),(0,L.jsx)("span",{className:"sf2-icon-x1",onClick:this.onCloseUpload})]}),r=this.props,o=r.totalProgress,l=r.allFilesUploaded,c=r.retryFileList;return(0,L.jsxs)("div",{className:"uploader-list-view mw-100",style:{height:this.state.isMinimized?"2.25rem":"20rem"},children:[(0,L.jsxs)("div",{className:"uploader-list-header",children:[(0,L.jsx)("div",{className:"title",children:100===o?a:i}),(0,L.jsx)("div",{className:"uploader-options",children:100===o||l?n:s})]}),(0,L.jsxs)("div",{className:"uploader-list-content",children:[(0,L.jsxs)("div",{className:"text-right mt-2",children:[c.length>0?(0,L.jsx)("span",{className:"cursor-pointer",onClick:this.props.onUploadRetryAll,children:(0,k.ih)("Retry All")}):(0,L.jsx)("span",{className:"cursor-pointer disabled-link",children:(0,k.ih)("Retry All")}),l?(0,L.jsx)("span",{className:"cursor-pointer ml-3 disabled-link",children:(0,k.ih)("Cancel All")}):(0,L.jsx)("span",{className:"cursor-pointer ml-3",onClick:this.onCancelAllUploading,children:(0,k.ih)("Cancel All")})]}),(0,L.jsxs)("table",{className:"table-thead-hidden",children:[(0,L.jsx)("thead",{children:(0,L.jsxs)("tr",{children:[(0,L.jsx)("th",{width:"30%",children:(0,k.ih)("name")}),(0,L.jsx)("th",{width:"20%",children:(0,k.ih)("size")}),(0,L.jsx)("th",{width:"30%",children:(0,k.ih)("progress")}),(0,L.jsx)("th",{width:"20%",children:(0,k.ih)("state")})]})}),(0,L.jsxs)("tbody",{children:[this.props.forbidUploadFileList.map((function(e,t){return(0,L.jsx)(E,{file:e},t)})),this.props.uploadFileList.map((function(t,a){return(0,L.jsx)(T,{resumableFile:t,onUploadCancel:e.props.onUploadCancel,onUploadRetry:e.props.onUploadRetry},a)}))]})]})]})]})}}]),a}(d.Component),B=(a(65271),function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(e){var i;return(0,n.Z)(this,a),(i=t.call(this,e)).componentWillUnmount=function(){window.onbeforeunload=null,!0===i.props.dragAndDrop&&i.resumable.disableDropOnDocument()},i.onbeforeunload=function(){if(window.uploader&&window.uploader.isUploadProgressDialogShow&&100!==window.uploader.totalProgress)return""},i.bindCallbackHandler=function(){var e=i.props,t=e.minFileSizeErrorCallback,a=e.fileTypeErrorCallback;i.maxFilesErrorCallback&&(i.resumable.opts.maxFilesErrorCallback=i.maxFilesErrorCallback),t&&(i.resumable.opts.minFileSizeErrorCallback=i.props.minFileSizeErrorCallback),i.maxFileSizeErrorCallback&&(i.resumable.opts.maxFileSizeErrorCallback=i.maxFileSizeErrorCallback),a&&(i.resumable.opts.fileTypeErrorCallback=i.props.fileTypeErrorCallback)},i.bindEventHandler=function(){i.resumable.on("chunkingComplete",i.onChunkingComplete.bind((0,o.Z)(i))),i.resumable.on("fileAdded",i.onFileAdded.bind((0,o.Z)(i))),i.resumable.on("filesAddedComplete",i.filesAddedComplete.bind((0,o.Z)(i))),i.resumable.on("fileProgress",i.onFileProgress.bind((0,o.Z)(i))),i.resumable.on("fileSuccess",i.onFileUploadSuccess.bind((0,o.Z)(i))),i.resumable.on("progress",i.onProgress.bind((0,o.Z)(i))),i.resumable.on("complete",i.onComplete.bind((0,o.Z)(i))),i.resumable.on("pause",i.onPause.bind((0,o.Z)(i))),i.resumable.on("fileRetry",i.onFileRetry.bind((0,o.Z)(i))),i.resumable.on("fileError",i.onFileError.bind((0,o.Z)(i))),i.resumable.on("error",i.onError.bind((0,o.Z)(i))),i.resumable.on("beforeCancel",i.onBeforeCancel.bind((0,o.Z)(i))),i.resumable.on("cancel",i.onCancel.bind((0,o.Z)(i))),i.resumable.on("dragstart",i.onDragStart.bind((0,o.Z)(i)))},i.maxFilesErrorCallback=function(e,t){var a=k.dd,i=(0,k.ih)("Please upload no more than {maxFiles} files at a time.");i=i.replace("{maxFiles}",a),C.Z.danger(i)},i.maxFileSizeErrorCallback=function(e){var t=i.state.forbidUploadFileList;t.push(e),i.setState({forbidUploadFileList:t})},i.onChunkingComplete=function(e){!0===i.state.allFilesUploaded&&i.setState({allFilesUploaded:!1});var t="/"===i.props.path?"/":i.props.path+"/",a=e.fileName,s=e.relativePath,n=a===s;if(e.formData={},n)e.formData={parent_dir:t};else{var r=s.slice(0,s.lastIndexOf("/")+1);e.formData={parent_dir:t,relative_path:r}}},i.onFileAdded=function(e,t){if(e.fileName===e.relativePath&&1===t.length){i.setUploadFileList(i.resumable.files);var a=i.props,s=a.token,n=a.relativePath;I.I.sharedLinkGetFileUploadUrl(s,n).then((function(t){i.resumable.opts.target=t.data.upload_link+"?ret-json=1",i.resumableUpload(e)})).catch((function(e){var t=F.c.getErrorMsg(e);C.Z.danger(t)}))}else if(i.setUploadFileList(i.resumable.files),!i.isUploadLinkLoaded){i.isUploadLinkLoaded=!0;var r=i.props,o=r.token,l=r.relativePath;I.I.sharedLinkGetFileUploadUrl(o,l).then((function(e){i.resumable.opts.target=e.data.upload_link+"?ret-json=1",i.resumable.upload()})).catch((function(e){var t=F.c.getErrorMsg(e);C.Z.danger(t)}))}},i.resumableUpload=function(e){var t=i.props,a=t.repoID,s=t.path;I.I.getFileUploadedBytes(a,s,e.fileName).then((function(t){var a=t.data.uploadedBytes,s=1024*parseInt(k.pL)*1024||1048576,n=Math.floor(a/s);e.markChunksCompleted(n),i.resumable.upload()})).catch((function(e){var t=F.c.getErrorMsg(e);C.Z.danger(t)}))},i.filesAddedComplete=function(e,t){i.state.forbidUploadFileList.length>0&&0===t.length&&i.setState({isUploadProgressDialogShow:!0,totalProgress:100})},i.setUploadFileList=function(){var e=i.resumable.files;i.setState({uploadFileList:e,isUploadProgressDialogShow:!0}),F.c.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)},i.onFileProgress=function(e){var t=i.getBitrate(),a=i.state.uploadFileList.map((function(a){if(a.uniqueIdentifier===e.uniqueIdentifier&&t){var i=8*(a.size-a.size*a.progress()),s=Math.floor(i/t);a.remainingTime=s}return a}));i.setState({uploadBitrate:t,uploadFileList:a})},i.getBitrate=function(){var e=0,t=0,a=(new Date).getTime();if(i.resumable.files.forEach((function(t){e+=t.progress()*t.size})),i.timestamp){var s=a-i.timestamp;if(s<i.bitrateInterval)return i.state.uploadBitrate;(e<i.loaded||0===i.loaded)&&(i.loaded=e),t=(e-i.loaded)*(1e3/s)*8}return i.timestamp=a,i.loaded=e,t},i.onProgress=function(){var e=Math.round(100*i.resumable.progress());i.setState({totalProgress:e}),F.c.registerGlobalVariable("uploader","totalProgress",e)},i.onFileUploadSuccess=function(e,t){var a=e.formData,s=(new Date).getTime()/1e3;t=a.replace?t:JSON.parse(t)[0],a.relative_path;var n={id:t.id,type:"file",name:t.name,size:t.size,mtime:s};i.props.onFileUploadSuccess(n);var r=i.state.uploadFileList.map((function(a){return a.uniqueIdentifier===e.uniqueIdentifier&&(a.newFileName=t.name,a.isSaved=!0),a}));i.setState({uploadFileList:r})},i.onFileError=function(e,t){var a="";if(t){var s=t.replace(/\n/g,"");s=JSON.parse(s),"File locked by others."===(a=s.error)&&(a=(0,k.ih)("File is locked by others.")),"Internal error."===a&&(a=(0,k.ih)("Internal Server Error"))}else a=(0,k.ih)("Network error");var n=i.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(i.state.retryFileList.push(t),t.error=a),t}));i.loaded=0,i.setState({retryFileList:i.state.retryFileList,uploadFileList:n})},i.onComplete=function(){i.notifiedFolders=[],i.isUploadLinkLoaded=!1,i.setState({allFilesUploaded:!0})},i.onPause=function(){},i.onError=function(e){i.isUploadLinkLoaded=!1,F.c.registerGlobalVariable("uploader","totalProgress",100)},i.onFileRetry=function(){},i.onBeforeCancel=function(){},i.onCancel=function(){},i.setHeaders=function(e,t){var a=t.offset,i=t.getOpt("chunkSize"),s=0===e.size?1:e.size,n=0!==a?a*i:0,r=Math.min(s,(a+1)*i)-1;return s-t.endByte<i&&!t.getOpt("forceChunkSize")&&(r=s),{Accept:"application/json; text/javascript, */*; q=0.01","Content-Disposition":'attachment; filename="'+encodeURI(e.fileName)+'"',"Content-Range":"bytes "+n+"-"+r+"/"+s}},i.setQuery=function(e){return e.formData},i.generateUniqueIdentifier=function(e){var t=e.webkitRelativePath||e.relativePath||e.fileName||e.name;return p()(t+new Date)+t},i.onClick=function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},i.onFileUpload=function(){i.uploadInput.current.removeAttribute("webkitdirectory"),i.uploadInput.current.click()},i.onFolderUpload=function(){i.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory"),i.uploadInput.current.click()},i.onDragStart=function(){i.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory")},i.onCloseUploadDialog=function(){i.loaded=0,i.resumable.files=[],i.isUploadLinkLoaded=!1,i.setState({isUploadProgressDialogShow:!1,uploadFileList:[],forbidUploadFileList:[]}),F.c.registerGlobalVariable("uploader","isUploadProgressDialogShow",!1)},i.onUploadCancel=function(e){var t=i.state.uploadFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier||(t.cancel(),!1)}));i.resumable.isUploading()||(i.setState({totalProgress:"100",allFilesUploaded:!0}),i.loaded=0),i.setState({uploadFileList:t})},i.onCancelAllUploading=function(){var e=i.state.uploadFileList.filter((function(e){return!Math.round(1!==e.progress())||(e.cancel(),!1)}));i.loaded=0,i.setState({allFilesUploaded:!0,totalProgress:"100",uploadFileList:e}),i.isUploadLinkLoaded=!1},i.onUploadRetry=function(e){var t=i.props,a=t.token,s=t.relativePath;I.I.sharedLinkGetFileUploadUrl(a,s).then((function(t){i.resumable.opts.target=t.data.upload_link+"?ret-json=1";var a=i.state.retryFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier})),s=i.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(t.error=null,i.retryUploadFile(t)),t}));i.setState({retryFileList:a,uploadFileList:s})})).catch((function(e){var t=F.c.getErrorMsg(e);C.Z.danger(t)}))},i.onUploadRetryAll=function(){var e=i.props,t=e.token,a=e.relativePath;I.I.sharedLinkGetFileUploadUrl(t,a).then((function(e){i.resumable.opts.target=e.data.upload_link+"?ret-json=1",i.state.retryFileList.forEach((function(e){e.error=!1,i.retryUploadFile(e)}));var t=i.state.uploadFileList.slice(0);i.setState({retryFileList:[],uploadFileList:t})})).catch((function(e){var t=F.c.getErrorMsg(e);C.Z.danger(t)}))},i.retryUploadFile=function(e){var t=i.props,a=t.repoID,s=t.path,n=e.fileName;if(!(e.fileName===e.relativePath)){var r=e.formData.relative_path;n=("/"===s?s+r:s+"/"+r)+n}e.bootstrap();var o=!1;e.resumableObj.on("chunkingComplete",(function(){o||I.I.getFileUploadedBytes(a,s,n).then((function(t){var a=t.data.uploadedBytes,i=1024*parseInt(k.pL)*1024||1048576,s=Math.floor(a/i);e.markChunksCompleted(s),e.resumableObj.upload()})).catch((function(e){var t=F.c.getErrorMsg(e);C.Z.danger(t)})),o=!0}))},i.uploadFile=function(){var e=i.resumable.files[i.resumable.files.length-1],t=i.props,a=t.token,s=t.relativePath;I.I.sharedLinkGetFileUploadUrl(a,s).then((function(t){i.resumable.opts.target=t.data.upload_link+"?ret-json=1",i.setState({isUploadRemindDialogShow:!1,isUploadProgressDialogShow:!0,uploadFileList:[].concat((0,N.Z)(i.state.uploadFileList),[e])},(function(){i.resumable.upload()})),F.c.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)})).catch((function(e){var t=F.c.getErrorMsg(e);C.Z.danger(t)}))},i.cancelFileUpload=function(){i.resumable.files.pop(),i.setState({isUploadRemindDialogShow:!1})},i.state={retryFileList:[],uploadFileList:[],forbidUploadFileList:[],totalProgress:0,isUploadProgressDialogShow:!1,isUploadRemindDialogShow:!1,currentResumableFile:null,uploadBitrate:0,allFilesUploaded:!1},i.uploadInput=d.createRef(),i.notifiedFolders=[],i.timestamp=null,i.loaded=0,i.bitrateInterval=500,window.onbeforeunload=i.onbeforeunload,i.isUploadLinkLoaded=!1,i}return(0,r.Z)(a,[{key:"componentDidMount",value:function(){this.resumable=new(P())({target:"",query:this.setQuery||{},fileType:this.props.filetypes,maxFiles:k.dd||void 0,maxFileSize:1e3*k.Og*1e3||void 0,testMethod:this.props.testMethod||"post",testChunks:this.props.testChunks||!1,headers:this.setHeaders||{},withCredentials:this.props.withCredentials||!1,chunkSize:1024*parseInt(k.pL)*1024||1048576,simultaneousUploads:this.props.simultaneousUploads||1,fileParameterName:this.props.fileParameterName,generateUniqueIdentifier:this.generateUniqueIdentifier,forceChunkSize:!0,maxChunkRetries:3,minFileSize:0}),this.resumable.assignBrowse(this.uploadInput.current,!0),!0===this.props.dragAndDrop&&this.resumable.enableDropOnDocument(),this.bindCallbackHandler(),this.bindEventHandler()}},{key:"render",value:function(){return(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("div",{className:"file-uploader-container",children:(0,L.jsx)("div",{className:"file-uploader",children:(0,L.jsx)("input",{className:"upload-input",type:"file",ref:this.uploadInput,onClick:this.onClick})})}),this.state.isUploadProgressDialogShow&&(0,L.jsx)(A,{retryFileList:this.state.retryFileList,uploadFileList:this.state.uploadFileList,forbidUploadFileList:this.state.forbidUploadFileList,totalProgress:this.state.totalProgress,uploadBitrate:this.state.uploadBitrate,allFilesUploaded:this.state.allFilesUploaded,onCloseUploadDialog:this.onCloseUploadDialog,onCancelAllUploading:this.onCancelAllUploading,onUploadCancel:this.onUploadCancel,onUploadRetry:this.onUploadRetry,onUploadRetryAll:this.onUploadRetryAll})]})}}]),a}(d.Component)),q=B,G=a(62298),H=a(4292),V=a(95234),Y=a(38122),Q=a(95060),W=a(71218),J=function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(e){var i;return(0,n.Z)(this,a),(i=t.call(this,e)).onSaveSharedFile=function(){i.props.handleSaveSharedDir(i.state.repo.repo_id,i.state.selectedPath)},i.onDirentItemClick=function(e,t,a){"dir"===a.type?i.setState({repo:e,selectedPath:t}):i.setState({repo:null,selectedPath:""})},i.onRepoItemClick=function(e){i.setState({repo:e,selectedPath:"/"})},i.state={repo:null,selectedPath:"",errMessage:""},i}return(0,r.Z)(a,[{key:"render",value:function(){return(0,L.jsxs)(G.Z,{isOpen:!0,className:"sf-save-file",children:[(0,L.jsx)(H.Z,{toggle:this.props.toggleCancel,children:(0,k.ih)("Save to:")}),(0,L.jsxs)(V.Z,{children:[(0,L.jsx)(W.Z,{isShowFile:!1,onDirentItemClick:this.onDirentItemClick,onRepoItemClick:this.onRepoItemClick,mode:"only_all_repos"}),this.state.errMessage&&(0,L.jsx)(Y.Z,{color:"danger",children:this.state.errMessage})]}),(0,L.jsxs)(Q.Z,{children:[(0,L.jsx)(m.Z,{color:"secondary",onClick:this.props.toggleCancel,children:(0,k.ih)("Cancel")}),this.state.selectedPath?(0,L.jsx)(m.Z,{color:"primary",onClick:this.onSaveSharedFile,children:(0,k.ih)("Submit")}):(0,L.jsx)(m.Z,{color:"primary",disabled:!0,children:(0,k.ih)("Submit")})]})]})}}]),a}(d.Component),$=a(35841),K=a(83339),X=a(25335);a(12188);b().locale(window.app.config.lang);var ee=window.app.pageOptions.name,te=window.shared.pageOptions,ae=te.token,ie=te.dirName,se=te.dirPath,ne=te.sharedBy,re=te.repoID,oe=te.relativePath,le=te.mode,ce=te.thumbnailSize,de=te.zipped,he=te.trafficOverLimit,pe=te.canDownload,ue=te.noQuota,me=te.canUpload,ge=te.enableVideoThumbnail,fe=!he&&pe,ve=function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(e){var i;return(0,n.Z)(this,a),(i=t.call(this,e)).sortItems=function(e,t){i.setState({sortBy:e,sortOrder:t,items:F.c.sortDirentsInSharedDir(i.state.items,e,t)})},i.getThumbnails=function(){var e=i.state.items.filter((function(e){return!e.is_dir&&(F.c.imageCheck(e.file_name)||ge&&F.c.videoCheck(e.file_name))&&!e.encoded_thumbnail_src}));if(0!=e.length){var t=e.length,a=(0,o.Z)(i);!function i(s){var n=e[s];I.I.getShareLinkThumbnail(ae,n.file_path,ce).then((function(e){n.encoded_thumbnail_src=e.data.encoded_thumbnail_src})).catch((function(e){})).then((function(){s<t-1?i(++s):a.setState({items:a.state.items})}))}(0)}},i.renderPath=function(){return(0,L.jsxs)(d.Fragment,{children:[de.map((function(e,t){if(t!=de.length-1)return(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(e.path),"&mode=").concat(le),className:"mx-1 ellipsis",title:e.name,children:e.name}),(0,L.jsx)("span",{children:" / "})]},t)})),(0,L.jsx)("span",{className:"ml-1 ellipsis",title:de[de.length-1].name,children:de[de.length-1].name})]})},i.zipDownloadFolder=function(e){k.Zb?I.I.getShareLinkZipTask(ae,e).then((function(e){var t=e.data.zip_token;location.href="".concat(k.gc,"zip/").concat(t)})).catch((function(e){var t=F.c.getErrorMsg(e);i.setState({isLoading:!1,errorMsg:t})})):i.setState({isZipDialogOpen:!0,zipFolderPath:e})},i.zipDownloadSelectedItems=function(){if(k.Zb){var e=i.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}));I.I.getShareLinkDirentsZipTask(ae,oe,e).then((function(e){var t=e.data.zip_token;location.href="".concat(k.gc,"zip/").concat(t)})).catch((function(e){var t=F.c.getErrorMsg(e);i.setState({isLoading:!1,errorMsg:t})}))}else i.setState({isZipDialogOpen:!0,zipFolderPath:oe,selectedItems:i.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},i.saveSelectedItems=function(){i.setState({isSaveSharedDirDialogShow:!0,itemsForSave:i.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},i.saveAllItems=function(){i.setState({isSaveSharedDirDialogShow:!0,itemsForSave:i.state.items.map((function(e){return e.file_name||e.folder_name}))})},i.toggleSaveSharedDirCancel=function(){i.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[]})},i.handleSaveSharedDir=function(e,t){var a=i.state.itemsForSave;I.I.saveSharedDir(e,t,ae,oe,a).then((function(e){i.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[],isCopyMoveProgressDialogShow:!0,asyncCopyMoveTaskId:e.data.task_id,asyncOperatedFilesLength:a.length},(function(){i.getAsyncCopyMoveProgress()}))})).catch((function(e){var t=F.c.getErrorMsg(e);i.setState({errMessage:t})}))},i.onProgressDialogToggle=function(){if(100!==i.state.asyncOperationProgress){var e=i.state.asyncCopyMoveTaskId;I.I.cancelCopyMoveOperation(e)}i.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1})},i.closeZipDialog=function(){i.setState({isZipDialogOpen:!1,zipFolderPath:"",selectedItems:[]})},i.prepareImageItem=function(e){var t=e.file_name,a="gif"==t.substr(t.lastIndexOf(".")+1).toLowerCase(),i="".concat(k.ze,"d/").concat(ae,"/files/?p=").concat(encodeURIComponent(e.file_path));return{name:t,url:i,src:a?"".concat(i,"&raw=1"):"".concat(k.ze,"thumbnail/").concat(ae,"/").concat(k.fp).concat(F.c.encodePath(e.file_path))}},i.showImagePopup=function(e){var t=i.state.items.filter((function(e){return!e.is_dir&&F.c.imageCheck(e.file_name)})),a=t.map((function(e){return i.prepareImageItem(e)}));i.setState({isImagePopupOpen:!0,imageItems:a,imageIndex:t.indexOf(e)})},i.closeImagePopup=function(){i.setState({isImagePopupOpen:!1})},i.moveToPrevImage=function(){var e=i.state.imageItems.length;i.setState((function(t){return{imageIndex:(t.imageIndex+e-1)%e}}))},i.moveToNextImage=function(){var e=i.state.imageItems.length;i.setState((function(t){return{imageIndex:(t.imageIndex+1)%e}}))},i.toggleAllSelected=function(){i.setState((function(e){return{isAllItemsSelected:!e.isAllItemsSelected,items:i.state.items.map((function(t){return t.isSelected=!e.isAllItemsSelected,t}))}}))},i.toggleItemSelected=function(e,t){i.setState({items:i.state.items.map((function(a){return a===e&&(a.isSelected=t),a}))},(function(){i.setState({isAllItemsSelected:!i.state.items.some((function(e){return!e.isSelected}))})}))},i.onUploadFile=function(e){e.nativeEvent.stopImmediatePropagation(),i.uploader.onFileUpload()},i.onFileUploadSuccess=function(e){var t=e.name,a=e.size,s={isSelected:!1,file_name:t,file_path:F.c.joinPath(oe,t),is_dir:!1,last_modified:b()().format(),size:a},n=i.state.items.filter((function(e){return e.is_dir})),r=Array.from(i.state.items);r.splice(n.length,0,s),i.setState({items:r}),I.I.shareLinksUploadDone(ae,F.c.joinPath(se,t))},i.getShareLinkRepoTags=function(){I.I.getShareLinkRepoTags(ae).then((function(e){var t=[];e.data.repo_tags.forEach((function(e){var a=new X.Z(e);a.fileCount>0&&t.push(a)})),i.setState({usedRepoTags:t}),0!=t.length&&"/"==oe&&i.setState({isRepoInfoBarShow:!0})})).catch((function(e){var t=F.c.getErrorMsg(e);C.Z.danger(t)}))},i.state={isLoading:!0,errorMsg:"",items:[],isAllItemsSelected:!1,selectedItems:[],sortBy:"name",sortOrder:"asc",isZipDialogOpen:!1,zipFolderPath:"",usedRepoTags:[],isRepoInfoBarShow:!1,isSaveSharedDirDialogShow:!1,itemsForSave:[],asyncCopyMoveTaskId:"",asyncOperationProgress:0,asyncOperatedFilesLength:0,isCopyMoveProgressDialogShow:!1,isImagePopupOpen:!1,imageItems:[],imageIndex:0},i}return(0,r.Z)(a,[{key:"componentDidMount",value:function(){var e=this;he&&C.Z.danger((0,k.ih)("File download is disabled: the share link traffic of owner is used up."),{duration:3}),I.I.listSharedDir(ae,oe,ce).then((function(t){var a=t.data.dirent_list.map((function(e){return e.isSelected=!1,e}));e.setState({isLoading:!1,errorMsg:"",items:F.c.sortDirentsInSharedDir(a,e.state.sortBy,e.state.sortOrder)}),e.getThumbnails()})).catch((function(t){var a=F.c.getErrorMsg(t);e.setState({isLoading:!1,errorMsg:a})})),this.getShareLinkRepoTags()}},{key:"getAsyncCopyMoveProgress",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,a,s,n,r,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.asyncCopyMoveTaskId,e.prev=1,e.next=4,I.I.queryAsyncOperationProgress(t);case 4:if(a=e.sent,!(s=a.data).failed){e.next=11;break}return n=(0,k.ih)("Failed to copy files to another library."),C.Z.danger(n),this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1}),e.abrupt("return");case 11:if(!s.successful){e.next=16;break}return this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1}),r=(0,k.ih)("Successfully copied files to another library."),C.Z.success(r),e.abrupt("return");case 16:o=s.total?parseInt((s.done/s.total*100).toFixed(2)):0,this.getAsyncCopyMoveProgress(),this.setState({asyncOperationProgress:o}),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1});case 24:case"end":return e.stop()}}),e,this,[[1,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=F.c.isDesktop(),a="btn btn-secondary btn-icon sf-view-mode-btn";return(0,L.jsxs)(d.Fragment,{children:[(0,L.jsxs)("div",{className:"h-100 d-flex flex-column",children:[(0,L.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[(0,L.jsx)("a",{href:k.ze,children:(0,L.jsx)("img",{src:k.si+k.j1,height:k.AN,width:k.Bv,title:k.y7,alt:"logo"})}),ee&&(0,L.jsx)(S.Z,{})]}),(0,L.jsx)("div",{className:"o-auto",children:(0,L.jsxs)("div",{className:"shared-dir-view-main",children:[(0,L.jsx)("h2",{className:"h3",children:ie}),(0,L.jsxs)("p",{children:[(0,k.ih)("Shared by: "),ne]}),(0,L.jsxs)("div",{className:"d-flex justify-content-between align-items-center op-bar",children:[(0,L.jsxs)("p",{className:"m-0 mr-4 ellipsis d-flex align-items-center",children:[(0,L.jsx)("span",{className:"flex-none",children:(0,k.ih)("Current path: ")}),this.renderPath()]}),(0,L.jsxs)("div",{className:"flex-none",children:[t&&(0,L.jsxs)("div",{className:"view-mode btn-group",children:[(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(oe),"&mode=list"),className:"".concat(a," sf2-icon-list-view ").concat("list"==le?"current-mode":""),title:(0,k.ih)("List"),"aria-label":(0,k.ih)("List")}),(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(oe),"&mode=grid"),className:"".concat(a," sf2-icon-grid-view ").concat("grid"==le?"current-mode":""),title:(0,k.ih)("Grid"),"aria-label":(0,k.ih)("Grid")})]}),me&&(0,L.jsx)(m.Z,{disabled:ue,title:ue?(0,k.ih)("The owner of this library has run out of space."):"",onClick:this.onUploadFile,className:"ml-2 shared-dir-op-btn shared-dir-upload-btn",children:(0,k.ih)("Upload")}),fe&&(0,L.jsx)(d.Fragment,{children:this.state.items.some((function(e){return e.isSelected}))?(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)(m.Z,{color:"success",onClick:this.zipDownloadSelectedItems,className:"ml-2 shared-dir-op-btn",children:(0,k.ih)("ZIP Selected Items")}),pe&&ee&&ee!==ne&&(0,L.jsx)(m.Z,{color:"success",onClick:this.saveSelectedItems,className:"ml-2 shared-dir-op-btn",children:(0,k.ih)("Save Selected Items")})]}):(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)(m.Z,{color:"success",onClick:this.zipDownloadFolder.bind(this,oe),className:"ml-2 shared-dir-op-btn",children:(0,k.ih)("ZIP")}),pe&&ee&&ee!==ne&&(0,L.jsx)(m.Z,{color:"success",onClick:this.saveAllItems,className:"ml-2 shared-dir-op-btn",children:(0,k.ih)("Save")})]})})]})]}),!ue&&me&&(0,L.jsx)(q,{ref:function(t){return e.uploader=t},dragAndDrop:!1,token:ae,path:"/"===se?se:se.replace(/\/+$/,""),relativePath:"/"===oe?oe:oe.replace(/\/+$/,""),repoID:re,onFileUploadSuccess:this.onFileUploadSuccess}),this.state.isRepoInfoBarShow&&(0,L.jsx)(K.Z,{repoID:re,currentPath:"/",usedRepoTags:this.state.usedRepoTags,shareLinkToken:ae,enableFileDownload:fe,className:"mx-0"}),(0,L.jsx)(xe,{isDesktop:t,isLoading:this.state.isLoading,errorMsg:this.state.errorMsg,items:this.state.items,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder,sortItems:this.sortItems,isAllItemsSelected:this.state.isAllItemsSelected,toggleAllSelected:this.toggleAllSelected,toggleItemSelected:this.toggleItemSelected,zipDownloadFolder:this.zipDownloadFolder,showImagePopup:this.showImagePopup})]})})]}),this.state.isZipDialogOpen&&(0,L.jsx)(Z.Z,{children:(0,L.jsx)(D.Z,{token:ae,path:this.state.zipFolderPath,target:this.state.selectedItems,toggleDialog:this.closeZipDialog})}),this.state.isSaveSharedDirDialogShow&&(0,L.jsx)(J,{sharedToken:ae,parentDir:oe,items:this.state.itemsForSave,toggleCancel:this.toggleSaveSharedDirCancel,handleSaveSharedDir:this.handleSaveSharedDir}),this.state.isCopyMoveProgressDialogShow&&(0,L.jsx)($.Z,{type:"copy",asyncOperatedFilesLength:this.state.asyncOperatedFilesLength,asyncOperationProgress:this.state.asyncOperationProgress,toggleDialog:this.onProgressDialogToggle}),this.state.isImagePopupOpen&&(0,L.jsx)(Z.Z,{children:(0,L.jsx)(y.Z,{imageItems:this.state.imageItems,imageIndex:this.state.imageIndex,closeImagePopup:this.closeImagePopup,moveToPrevImage:this.moveToPrevImage,moveToNextImage:this.moveToNextImage})})]})}}]),a}(d.Component),xe=function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(e){var i;return(0,n.Z)(this,a),(i=t.call(this,e)).sortByName=function(e){e.preventDefault();var t="asc"==i.props.sortOrder?"desc":"asc";i.props.sortItems("name",t)},i.sortByTime=function(e){e.preventDefault();var t="asc"==i.props.sortOrder?"desc":"asc";i.props.sortItems("time",t)},i.sortBySize=function(e){e.preventDefault();var t="asc"==i.props.sortOrder?"desc":"asc";i.props.sortItems("size",t)},i}return(0,r.Z)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.isDesktop,i=t.isLoading,s=t.errorMsg,n=t.items,r=t.sortBy,o=t.sortOrder,l=t.isAllItemsSelected;if(i)return(0,L.jsx)(w.Z,{});if(s)return(0,L.jsx)("p",{className:"error mt-6 text-center",children:s});var c=(0,L.jsx)("tbody",{children:n.map((function(t,i){return(0,L.jsx)(je,{isDesktop:a,item:t,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup,toggleItemSelected:e.props.toggleItemSelected},i)}))});if(!a)return(0,L.jsxs)("table",{className:"table-hover table-thead-hidden",children:[(0,L.jsx)("thead",{children:(0,L.jsxs)("tr",{children:[(0,L.jsx)("th",{width:"12%"}),(0,L.jsx)("th",{width:"80%"}),(0,L.jsx)("th",{width:"8%"})]})}),c]});var d=(0,L.jsx)("span",{className:"fas ".concat("asc"==o?"fa-caret-up":"fa-caret-down")});return"list"==le?(0,L.jsxs)("table",{className:"table-hover",children:[(0,L.jsx)("thead",{children:(0,L.jsxs)("tr",{children:[fe&&(0,L.jsx)("th",{width:"3%",className:"text-center",children:(0,L.jsx)("input",{type:"checkbox",checked:l,onChange:this.props.toggleAllSelected})}),(0,L.jsx)("th",{width:"5%"}),(0,L.jsx)("th",{width:fe?"50%":"53%",children:(0,L.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortByName,children:[(0,k.ih)("Name")," ","name"==r&&d]})}),(0,L.jsx)("th",{width:"8%"}),(0,L.jsx)("th",{width:"14%",children:(0,L.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortBySize,children:[(0,k.ih)("Size")," ","size"==r&&d]})}),(0,L.jsx)("th",{width:"13%",children:(0,L.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortByTime,children:[(0,k.ih)("Last Update")," ","time"==r&&d]})}),(0,L.jsx)("th",{width:"7%"})]})}),c]}):(0,L.jsx)("ul",{className:"grid-view",children:n.map((function(t,a){return(0,L.jsx)(be,{item:t,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup},a)}))})}}]),a}(d.Component),je=function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(e){var i;return(0,n.Z)(this,a),(i=t.call(this,e)).toggleOpMenu=function(){i.setState({isOpMenuOpen:!i.state.isOpMenuOpen})},i.handleMouseOver=function(){i.setState({isIconShown:!0})},i.handleMouseOut=function(){i.setState({isIconShown:!1})},i.zipDownloadFolder=function(e){e.preventDefault(),i.props.zipDownloadFolder.bind((0,o.Z)(i),i.props.item.folder_path)()},i.handleFileClick=function(e){var t=i.props.item;F.c.imageCheck(t.file_name)&&(e.preventDefault(),i.props.showImagePopup(t))},i.toggleItemSelected=function(e){i.props.toggleItemSelected(i.props.item,e.target.checked)},i.state={isIconShown:!1,isOpMenuOpen:!1},i}return(0,r.Z)(a,[{key:"render",value:function(){var e=this.props,t=e.item,a=e.isDesktop,i=this.state.isIconShown,s="",n="";if(t.file_tags&&t.file_tags.length>0&&(s=p()(t.file_name).slice(0,7),n=t.file_tags.map((function(e){return e.tag_name})).join(" ")),t.is_dir)return a?(0,L.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[fe&&(0,L.jsx)("td",{className:"text-center",children:(0,L.jsx)("input",{type:"checkbox",checked:t.isSelected,onChange:this.toggleItemSelected})}),(0,L.jsx)("td",{className:"text-center",children:(0,L.jsx)("img",{src:F.c.getFolderIconUrl(),alt:"",width:"24"})}),(0,L.jsx)("td",{children:(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(le),children:t.folder_name})}),(0,L.jsx)("td",{}),(0,L.jsx)("td",{}),(0,L.jsx)("td",{title:b()(t.last_modified).format("llll"),children:b()(t.last_modified).fromNow()}),(0,L.jsx)("td",{children:fe&&(0,L.jsx)("a",{role:"button",className:"action-icon sf2-icon-download".concat(i?"":" invisible"),href:"#",onClick:this.zipDownloadFolder,title:(0,k.ih)("Download"),"aria-label":(0,k.ih)("Download")})})]}):(0,L.jsxs)("tr",{children:[(0,L.jsx)("td",{className:"text-center",children:(0,L.jsx)("img",{src:F.c.getFolderIconUrl(),alt:"",width:"24"})}),(0,L.jsxs)("td",{children:[(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(le),children:t.folder_name}),(0,L.jsx)("br",{}),(0,L.jsx)("span",{className:"item-meta-info",children:b()(t.last_modified).fromNow()})]}),(0,L.jsx)("td",{children:fe&&(0,L.jsxs)(g.Z,{isOpen:this.state.isOpMenuOpen,toggle:this.toggleOpMenu,children:[(0,L.jsx)(f.Z,{tag:"i",className:"sf-dropdown-toggle fa fa-ellipsis-v ml-0",title:(0,k.ih)("More Operations"),"data-toggle":"dropdown","aria-expanded":this.state.isOpMenuOpen}),(0,L.jsxs)("div",{className:this.state.isOpMenuOpen?"":"d-none",onClick:this.toggleOpMenu,children:[(0,L.jsx)("div",{className:"mobile-operation-menu-bg-layer"}),(0,L.jsx)("div",{className:"mobile-operation-menu",children:(0,L.jsx)(v.Z,{className:"mobile-menu-item",onClick:this.zipDownloadFolder,children:(0,k.ih)("Download")})})]})]})})]});var r="".concat(k.ze,"d/").concat(ae,"/files/?p=").concat(encodeURIComponent(t.file_path)),o=t.encoded_thumbnail_src?"".concat(k.ze).concat(t.encoded_thumbnail_src):"";return a?(0,L.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[fe&&(0,L.jsx)("td",{className:"text-center",children:(0,L.jsx)("input",{type:"checkbox",checked:t.isSelected,onChange:this.toggleItemSelected})}),(0,L.jsx)("td",{className:"text-center",children:o?(0,L.jsx)("img",{className:"thumbnail",src:o,alt:""}):(0,L.jsx)("img",{src:F.c.getFileIconUrl(t.file_name),alt:"",width:"24"})}),(0,L.jsx)("td",{children:(0,L.jsx)("a",{href:r,onClick:this.handleFileClick,children:t.file_name})}),(0,L.jsx)("td",{className:"tag-list-title",children:t.file_tags&&t.file_tags.length>0&&(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("div",{id:"tag-list-title-".concat(s),className:"dirent-item tag-list tag-list-stacked",children:t.file_tags.map((function(e,a){var i=t.file_tags.length;return(0,L.jsx)("span",{className:"file-tag",style:{zIndex:i-a,backgroundColor:e.tag_color}},e.file_tag_id)}))}),(0,L.jsx)(x.Z,{target:"tag-list-title-".concat(s),placement:"bottom",children:n})]})}),(0,L.jsx)("td",{children:F.c.bytesToSize(t.size)}),(0,L.jsx)("td",{title:b()(t.last_modified).format("llll"),children:b()(t.last_modified).fromNow()}),(0,L.jsx)("td",{children:fe&&(0,L.jsx)("a",{className:"action-icon sf2-icon-download".concat(i?"":" invisible"),href:"".concat(r,"&dl=1"),title:(0,k.ih)("Download"),"aria-label":(0,k.ih)("Download")})})]}):(0,L.jsxs)("tr",{children:[(0,L.jsx)("td",{className:"text-center",children:o?(0,L.jsx)("img",{className:"thumbnail",src:o,alt:""}):(0,L.jsx)("img",{src:F.c.getFileIconUrl(t.file_name),alt:"",width:"24"})}),(0,L.jsxs)("td",{children:[(0,L.jsx)("a",{href:r,onClick:this.handleFileClick,children:t.file_name}),(0,L.jsx)("br",{}),(0,L.jsx)("span",{className:"item-meta-info",children:F.c.bytesToSize(t.size)}),(0,L.jsx)("span",{className:"item-meta-info",children:b()(t.last_modified).fromNow()})]}),(0,L.jsx)("td",{children:fe&&(0,L.jsxs)(g.Z,{isOpen:this.state.isOpMenuOpen,toggle:this.toggleOpMenu,children:[(0,L.jsx)(f.Z,{tag:"i",className:"sf-dropdown-toggle fa fa-ellipsis-v ml-0",title:(0,k.ih)("More Operations"),"data-toggle":"dropdown","aria-expanded":this.state.isOpMenuOpen}),(0,L.jsxs)("div",{className:this.state.isOpMenuOpen?"":"d-none",onClick:this.toggleOpMenu,children:[(0,L.jsx)("div",{className:"mobile-operation-menu-bg-layer"}),(0,L.jsx)("div",{className:"mobile-operation-menu",children:(0,L.jsx)(v.Z,{className:"mobile-menu-item",tag:"a",href:"".concat(r,"&dl=1"),children:(0,k.ih)("Download")})})]})]})})]})}}]),a}(d.Component),be=function(e){(0,l.Z)(a,e);var t=(0,c.Z)(a);function a(e){var i;return(0,n.Z)(this,a),(i=t.call(this,e)).handleMouseOver=function(){i.setState({isIconShown:!0})},i.handleMouseOut=function(){i.setState({isIconShown:!1})},i.zipDownloadFolder=function(e){e.preventDefault(),i.props.zipDownloadFolder.bind((0,o.Z)(i),i.props.item.folder_path)()},i.handleFileClick=function(e){var t=i.props.item;F.c.imageCheck(t.file_name)&&(e.preventDefault(),i.props.showImagePopup(t))},i.state={isIconShown:!1},i}return(0,r.Z)(a,[{key:"render",value:function(){var e=this.props.item,t=this.state.isIconShown;if(e.is_dir){var a="?p=".concat(encodeURIComponent(e.folder_path.substr(0,e.folder_path.length-1)),"&mode=").concat(le);return(0,L.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,L.jsx)("a",{href:a,className:"grid-file-img-link d-block",children:(0,L.jsx)("img",{src:F.c.getFolderIconUrl(!1,192),alt:"",width:"96",height:"96"})}),(0,L.jsx)("a",{href:a,className:"grid-file-name grid-file-name-link",children:e.folder_name}),fe&&(0,L.jsx)("a",{role:"button",className:"action-icon sf2-icon-download".concat(t?"":" invisible"),href:"#",onClick:this.zipDownloadFolder,title:(0,k.ih)("Download"),"aria-label":(0,k.ih)("Download")})]})}var i="".concat(k.ze,"d/").concat(ae,"/files/?p=").concat(encodeURIComponent(e.file_path)),s=e.encoded_thumbnail_src?"".concat(k.ze).concat(e.encoded_thumbnail_src):"";return(0,L.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,L.jsx)("a",{href:i,className:"grid-file-img-link d-block",onClick:this.handleFileClick,children:s?(0,L.jsx)("img",{className:"thumbnail",src:s,alt:""}):(0,L.jsx)("img",{src:F.c.getFileIconUrl(e.file_name,192),alt:"",width:"96",height:"96"})}),(0,L.jsx)("a",{href:i,className:"grid-file-name grid-file-name-link",onClick:this.handleFileClick,children:e.file_name}),fe&&(0,L.jsx)("a",{className:"action-icon sf2-icon-download".concat(t?"":" invisible"),href:"".concat(i,"&dl=1"),title:(0,k.ih)("Download"),"aria-label":(0,k.ih)("Download")})]})}}]),a}(d.Component);u.render((0,L.jsx)(ve,{}),document.getElementById("wrapper"))},12188:function(){}},function(e){e.O(0,[351],(function(){return t=9406,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=sharedDirView.2bfb8240.js.map