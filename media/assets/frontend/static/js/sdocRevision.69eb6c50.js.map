{"version":3,"file":"static/js/sdocRevision.69eb6c50.js","mappings":"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","sources":["components/common/go-back/index.js","pages/sdoc-revision/index.js"],"sourcesContent":["import React, { Component } from 'react';\n\nimport './index.css';\n\nclass GoBack extends Component {\n\n  onBackClick = (event) => {\n    event.preventDefault();\n    window.history.back();\n  };\n\n  render() {\n    return (\n      <div className=\"go-back\" onClick={this.onBackClick}>\n        <span className=\"fas fa-chevron-left\"></span>\n      </div>\n    );\n  }\n}\n\nexport default GoBack;\n","import React from 'react';\nimport ReactDom from 'react-dom';\nimport classnames from 'classnames';\nimport { Button } from 'reactstrap';\nimport { DiffViewer } from '@seafile/sdoc-editor';\nimport { gettext } from '../../utils/constants';\nimport Loading from '../../components/loading';\nimport GoBack from '../../components/common/go-back';\nimport { Utils } from '../../utils/utils';\nimport { seafileAPI } from '../../utils/seafile-api';\n\nimport '../../css/layout.css';\nimport '../../css/sdoc-revision.css';\nimport toaster from '../../components/toast';\n\nconst { serviceURL, avatarURL, siteRoot } = window.app.config;\nconst { username, name } = window.app.pageOptions;\nconst { repoID, fileName, filePath, docUuid, assetsUrl, fileDownloadLink, originFileDownloadLink } = window.sdocRevision;\n\nwindow.seafile = {\n  repoID,\n  docPath: filePath,\n  docName: fileName,\n  docUuid,\n  isOpenSocket: false,\n  serviceUrl: serviceURL,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  assetsUrl,\n};\n\nclass SdocRevision extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      errorMessage: '',\n      revisionContent: '',\n      originContent: '',\n    };\n  }\n\n  componentDidMount() {\n    fetch(fileDownloadLink).then(res => {\n      return res.json();\n    }).then(revisionContent => {\n      fetch(originFileDownloadLink).then(res => {\n        return res.json();\n      }).then(originContent => {\n        this.setState({ revisionContent, originContent, isLoading: false, errorMessage: '' });\n      }).catch(error => {\n        const errorMessage = Utils.getErrorMsg(error, true);\n        this.setState({ isLoading: false, errorMessage });\n      });\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      this.setState({ isLoading: false, errorMessage });\n    });\n  }\n\n  edit = (event) => {\n    event.stopPropagation();\n    event.nativeEvent.stopImmediatePropagation();\n    window.location.href = `${siteRoot}lib/${repoID}/file${filePath}`;\n  };\n\n  publishRevision = (event) => {\n    event.stopPropagation();\n    event.nativeEvent.stopImmediatePropagation();\n    seafileAPI.sdocPublishRevision(docUuid).then(res => {\n      const { origin_file_path } = res.data;\n      window.location.href = `${siteRoot}lib/${repoID}/file${origin_file_path}`;\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, false);\n      toaster.danger(gettext(errorMessage));\n    });\n  };\n\n  renderContent = () => {\n    const { isLoading, errorMessage, revisionContent, originContent } = this.state;\n    if (isLoading) {\n      return (\n        <div className=\"sdoc-revision-viewer h-100 d-flex align-items-center justify-content-center\">\n          <Loading />\n        </div>\n      );\n    }\n\n    if (errorMessage) {\n      return (\n        <div className=\"sdoc-revision-viewer h-100 d-flex align-items-center justify-content-center\">\n          {gettext(errorMessage)}\n        </div>\n      );\n    }\n\n    return (\n      <DiffViewer\n        currentContent={revisionContent}\n        lastContent={originContent}\n      />\n    );\n  };\n\n  render() {\n    const { isLoading, errorMessage } = this.state;\n\n    return (\n      <div className=\"sdoc-revision d-flex h-100 w-100 o-hidden\">\n        <div className=\"sdoc-revision-container d-flex flex-column\">\n          <div className=\"sdoc-revision-header pl-4 pr-4 d-flex justify-content-between w-100 o-hidden\">\n            <div className={classnames('sdoc-revision-header-left h-100 d-flex align-items-center o-hidden')}>\n              <GoBack />\n              <div className=\"file-name text-truncate\">{fileName}</div>\n            </div>\n            <div className=\"sdoc-revision-header-right h-100 d-flex align-items-center\">\n              {(!isLoading && !errorMessage) && (\n                <>\n                  <Button color=\"success\" className=\"mr-4\" onClick={this.edit}>{gettext('Edit')}</Button>\n                  <Button color=\"success\" onClick={this.publishRevision}>{gettext('Publish')}</Button>\n                </>\n              )}\n            </div>\n          </div>\n          <div className=\"sdoc-revision-content f-flex\">\n            {this.renderContent()}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SdocRevision />, document.getElementById('wrapper'));\n"],"names":["GoBack","_Component","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","onBackClick","event","preventDefault","window","history","back","_createClass","key","value","_jsx","className","onClick","this","children","Component","_window$app$config","app","config","serviceURL","avatarURL","siteRoot","_window$app$pageOptio","pageOptions","username","name","_window$sdocRevision","sdocRevision","repoID","fileName","filePath","docUuid","assetsUrl","fileDownloadLink","originFileDownloadLink","seafile","docPath","docName","isOpenSocket","serviceUrl","SdocRevision","_React$Component","props","edit","stopPropagation","nativeEvent","stopImmediatePropagation","location","href","publishRevision","seafileAPI","sdocPublishRevision","then","res","origin_file_path","data","catch","error","errorMessage","Utils","getErrorMsg","toaster","danger","gettext","renderContent","_this$state","state","isLoading","revisionContent","originContent","Loading","DiffViewer","currentContent","lastContent","_this2","fetch","json","setState","_this$state2","_jsxs","classnames","_Fragment","Button","color","React","ReactDom","document","getElementById"],"sourceRoot":""}