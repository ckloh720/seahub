{"version":3,"file":"static/js/viewFileSdoc.c532c5c7.js","mappings":"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","sources":["_i18n/i18n-sdoc-editor.js","pages/sdoc-editor/external-operations.js","pages/sdoc-editor/index.js","view-file-sdoc.js"],"sourcesContent":["import i18n from 'i18next';\nimport Backend from 'i18next-xhr-backend';\nimport LanguageDetector from 'i18next-browser-languagedetector';\nimport { initReactI18next } from 'react-i18next';\nimport { mediaUrl } from '../utils/constants';\n\nconst { lang = 'en' } = window.app.config;\n\ni18n\n  .use(Backend)\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    lng: lang,\n    fallbackLng: 'en',\n    ns: ['sdoc-editor'],\n    defaultNS: 'sdoc-editor',\n\n    whitelist: ['en', 'zh-CN', 'fr', 'de', 'cs', 'es', 'es-AR', 'es-MX', 'ru'],\n\n    backend: {\n      loadPath: mediaUrl + 'sdoc-editor/locales/{{ lng }}/{{ ns }}.json',\n      // loadPath: '/media/locales/{{lng}}/{{ns}}.json',\n    },\n\n    debug: false, // console log if debug: true\n\n    interpolation: {\n      escapeValue: false, // not needed for react!!\n    },\n\n\n    load: 'currentOnly',\n\n    react: {\n      wait: true,\n    }\n  });\n\nexport default i18n;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { EventBus, EXTERNAL_EVENT } from '@seafile/sdoc-editor';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../../components/toast';\nimport InternalLinkDialog from '../../components/dialog/internal-link-dialog';\nimport ShareDialog from '../../components/dialog/share-dialog';\n\nconst propTypes = {\n  repoID: PropTypes.string.isRequired,\n  docPath: PropTypes.string.isRequired,\n  docName: PropTypes.string.isRequired,\n  docPerm: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  toggleStar: PropTypes.func.isRequired,\n  unmarkDraft: PropTypes.func.isRequired\n};\n\nclass ExternalOperations extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowInternalLinkDialog: false,\n      isShowShareDialog: false,\n    };\n  }\n\n  componentDidMount() {\n    const eventBus = EventBus.getInstance();\n    this.unsubscribeInternalLinkEvent = eventBus.subscribe(EXTERNAL_EVENT.INTERNAL_LINK_CLICK, this.onInternalLinkToggle);\n    this.unsubscribeStar = eventBus.subscribe(EXTERNAL_EVENT.TOGGLE_STAR, this.toggleStar);\n    this.unsubscribeUnmark = eventBus.subscribe(EXTERNAL_EVENT.UNMARK_AS_DRAFT, this.unmark);\n    this.unsubscribeShare = eventBus.subscribe(EXTERNAL_EVENT.SHARE_SDOC, this.onShareToggle);\n  }\n\n  componentWillUnmount() {\n    this.unsubscribeInternalLinkEvent();\n    this.unsubscribeStar();\n    this.unsubscribeUnmark();\n    this.unsubscribeShare();\n  }\n\n  onInternalLinkToggle = () => {\n    this.setState({isShowInternalLinkDialog: !this.state.isShowInternalLinkDialog});\n  };\n\n  unmark = () => {\n    const { repoID, docPath } = this.props;\n    seafileAPI.sdocUnmarkAsDraft(repoID, docPath).then((res) => {\n      this.props.unmarkDraft();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  toggleStar = () => {\n    const { isStarred, repoID, docPath  } = this.props;\n    if (isStarred) {\n      seafileAPI.unstarItem(repoID, docPath).then((res) => {\n        this.props.toggleStar(false);\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    } else {\n      seafileAPI.starItem(repoID, docPath).then((res) => {\n        this.props.toggleStar(true);\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    }\n  };\n\n  onShareToggle = () => {\n    this.setState({isShowShareDialog: !this.state.isShowShareDialog});\n  };\n\n  render() {\n    const { repoID, docPath, docName, docPerm } = this.props;\n    const { isShowInternalLinkDialog, isShowShareDialog } = this.state;\n    return (\n      <>\n        {isShowInternalLinkDialog && (\n          <InternalLinkDialog\n            repoID={repoID}\n            path={docPath}\n            onInternalLinkDialogToggle={this.onInternalLinkToggle}\n          />\n        )}\n        {isShowShareDialog && (\n          <ShareDialog\n            itemType={'file'}\n            itemPath={docPath}\n            itemName={docName}\n            repoID={repoID}\n            userPerm={docPerm}\n            toggleDialog={this.onShareToggle}\n          />\n        )}\n      </>\n    );\n  }\n}\n\nExternalOperations.propTypes = propTypes;\n\nexport default ExternalOperations;\n","import React, { Fragment } from 'react';\nimport { SimpleEditor } from '@seafile/sdoc-editor';\nimport ExternalOperations from './external-operations';\n\nexport default class SdocEditor extends React.Component {\n\n  constructor(props) {\n    super(props);\n    const { isStarred, isSdocDraft } = window.app.pageOptions;\n    this.state = {\n      isStarred: isStarred,\n      isDraft: isSdocDraft\n    };\n  }\n\n  toggleStar = (isStarred) => {\n    this.setState({isStarred: isStarred});\n  };\n\n  unmarkDraft = () => {\n    this.setState({isDraft: false});\n  };\n\n  render() {\n    const { repoID, docPath, docName, docPerm } = window.seafile;\n    const { isStarred, isDraft } = this.state;\n    return (\n      <Fragment>\n        <SimpleEditor isStarred={isStarred} isDraft={isDraft} />\n        <ExternalOperations\n          repoID={repoID}\n          docPath={docPath}\n          docName={docName}\n          docPerm={docPerm}\n          isStarred={isStarred}\n          toggleStar={this.toggleStar}\n          unmarkDraft={this.unmarkDraft}\n        />\n      </Fragment>\n    );\n  }\n}\n","import React, { Suspense } from 'react';\nimport ReactDom from 'react-dom';\nimport { I18nextProvider } from 'react-i18next';\nimport i18n from './_i18n/i18n-sdoc-editor';\nimport { Utils } from './utils/utils';\nimport Loading from './components/loading';\nimport SdocEditor from './pages/sdoc-editor';\n\nconst { serviceURL, avatarURL, siteRoot, lang } = window.app.config;\nconst { username, name } = window.app.userInfo;\nconst {\n  repoID, repoName, parentDir, filePerm,\n  docPath, docName, docUuid, seadocAccessToken, seadocServerUrl, assetsUrl,\n  isSdocRevision, isPublished, originFilename, revisionCreatedAt, originFileVersion,\n  originFilePath, originDocUuid,\n} = window.app.pageOptions;\n\nwindow.seafile = {\n  repoID,\n  docPath,\n  docName,\n  docUuid,\n  isOpenSocket: true,\n  serviceUrl: serviceURL,\n  accessToken: seadocAccessToken,\n  sdocServer: seadocServerUrl,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  docPerm: filePerm,\n  historyURL: Utils.generateHistoryURL(siteRoot, repoID, docPath),\n  parentFolderURL: `${siteRoot}library/${repoID}/${Utils.encodePath(repoName + parentDir)}`,\n  assetsUrl,\n  isShowInternalLink: true,\n  isStarIconShown: true, // for star/unstar\n  isSdocRevision,\n  isPublished,\n  revisionURL: Utils.generateRevisionURL(siteRoot, repoID, docPath),\n  originFilename,\n  originFileVersion,\n  originFilePath,\n  originDocUuid,\n  revisionCreatedAt,\n  lang,\n};\n\nReactDom.render(\n  <I18nextProvider i18n={ i18n } >\n    <Suspense fallback={<Loading />}>\n      <SdocEditor />\n    </Suspense>\n  </I18nextProvider>,\n  document.getElementById('wrapper')\n);\n"],"names":["_window$app$config$la","window","app","config","lang","i18n","Backend","use","LanguageDetector","initReactI18next","init","lng","fallbackLng","ns","defaultNS","whitelist","backend","loadPath","mediaUrl","debug","interpolation","escapeValue","load","react","wait","ExternalOperations","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","onInternalLinkToggle","setState","isShowInternalLinkDialog","state","unmark","_this$props","repoID","docPath","seafileAPI","sdocUnmarkAsDraft","then","res","unmarkDraft","catch","error","errMessage","Utils","getErrorMsg","toaster","danger","toggleStar","_this$props2","isStarred","unstarItem","errorMsg","starItem","onShareToggle","isShowShareDialog","_createClass","key","value","eventBus","EventBus","getInstance","this","unsubscribeInternalLinkEvent","subscribe","EXTERNAL_EVENT","INTERNAL_LINK_CLICK","unsubscribeStar","TOGGLE_STAR","unsubscribeUnmark","UNMARK_AS_DRAFT","unsubscribeShare","SHARE_SDOC","_this$props3","docName","docPerm","_this$state","_jsxs","_Fragment","children","_jsx","InternalLinkDialog","path","onInternalLinkDialogToggle","ShareDialog","itemType","itemPath","itemName","userPerm","toggleDialog","React","SdocEditor","isDraft","_window$app$pageOptio","pageOptions","isSdocDraft","_window$seafile","seafile","Fragment","SimpleEditor","_window$app$config","serviceURL","avatarURL","siteRoot","_window$app$userInfo","userInfo","username","name","repoName","parentDir","filePerm","docUuid","seadocAccessToken","seadocServerUrl","assetsUrl","isSdocRevision","isPublished","originFilename","revisionCreatedAt","originFileVersion","originFilePath","originDocUuid","isOpenSocket","serviceUrl","accessToken","sdocServer","historyURL","generateHistoryURL","parentFolderURL","concat","encodePath","isShowInternalLink","isStarIconShown","revisionURL","generateRevisionURL","ReactDom","I18nextProvider","Suspense","fallback","Loading","document","getElementById"],"sourceRoot":""}